import{_ as P,a as me,b as ce,Q as pe,c as k}from"./SearchBar-DJxEruSr.js";import{Q as ve}from"./QBadge-DqKeR-yY.js";import{Q as fe}from"./QPage-BBLQyAC7.js";import{c as $,o as u,w as t,b as e,a as A,d as _,Q,t as i,e as _e,k as ge,ad as ye,ae as be,v as x,a6 as we,i as m,af as Ce,j as n,ag as G,ah as H,f,a1 as xe,a5 as W,a3 as he,a4 as ke,a0 as $e,x as I,U as Ve,E as qe}from"./app-CVo2F_W3.js";import{_ as Qe}from"./PageHeader-CeaXU9p-.js";import{u as Se}from"./useResourceIndex-OJHyqOIO.js";import{u as Ue,C as J}from"./ConfirmationModal-C_oO7QLW.js";import{u as K}from"./useResourceUpdate-a58ld08K.js";import{u as Le}from"./usePollingInterval-ClLiuZEZ.js";import{b as ze,Q as S,a as U,h}from"./QMenu-Bv4-7jnn.js";import{Q as Ie,C as R}from"./ClosePopup-CbTDksMi.js";import{Q as De}from"./QForm-BsOaUD0C.js";import{u as Ne,_ as Me}from"./FormModal-3_KjRAQA.js";import{u as B}from"./useTextTruncate-BXow-7eB.js";import{u as Pe}from"./index-DZucgB02.js";import"./QSelect-BsTDJULy.js";import"./format-BOf40pHW.js";import"./QDrawer-BZwB_FoC.js";/* empty css               */import"./useFetch-CRpE6LrY.js";import"./QSpace-92-bbKT5.js";import"./QInnerLoading-CiQDGj4V.js";const Ae={__name:"ActionsColumn",props:{row:{type:Object,required:!0}},emits:["delete","show-details","status-change"],setup(r,{emit:s}){const y=s,p=b=>{y("delete",b)},o=(b,v)=>{y("status-change",b,v)};return(b,v)=>(u(),$(ge,{icon:"sym_r_more_horiz",padding:"xs",size:"sm",unelevated:""},{default:t(()=>[e(ze,{offset:[15,6],"transition-show":"jump-down","transition-hide":"jump-up",class:"q-pa-xs rounded-lg dark:bg-slate-700 shadow-lg border dark:border-none min-w-48"},{default:t(()=>[e(Ie,{style:{"min-width":"100px"},dense:"",class:"q-pa-xs"},{default:t(()=>[A((u(),$(S,{to:{name:"servers.show",params:{id:r.row.id}},clickable:"",class:"text-gray-600 dark:text-gray-200 rounded-md"},{default:t(()=>[e(U,null,{default:t(()=>[e(h,{class:"flex-nowrap"},{default:t(()=>[e(Q,{name:"sym_r_visibility",size:"xs",class:"me-1"}),_(" "+i(b.$t("view_details")),1)]),_:1})]),_:1})]),_:1},8,["to"])),[[R]]),r.row.status.value==="running"?A((u(),$(S,{key:0,onClick:v[0]||(v[0]=d=>o(r.row,"stop")),clickable:"",class:"text-yellow-600 dark:text-yellow-400 rounded-md"},{default:t(()=>[e(U,null,{default:t(()=>[e(h,{class:"flex-nowrap"},{default:t(()=>[e(Q,{name:"sym_r_stop_circle",size:"xs",class:"me-1"}),_(" "+i(b.$t("servers.stop_server")),1)]),_:1})]),_:1})]),_:1})),[[R]]):A((u(),$(S,{key:1,onClick:v[1]||(v[1]=d=>o(r.row,"start")),clickable:"",class:"text-green-600 dark:text-green-400 rounded-md"},{default:t(()=>[e(U,null,{default:t(()=>[e(h,{class:"flex-nowrap"},{default:t(()=>[e(Q,{name:"sym_r_play_circle",size:"xs",class:"me-1"}),_(" "+i(b.$t("servers.start_server")),1)]),_:1})]),_:1})]),_:1})),[[R]]),e(_e,{class:"q-my-xs"}),A((u(),$(S,{onClick:v[2]||(v[2]=d=>p(r.row)),clickable:"",class:"text-red-600 dark:text-red-400 rounded-md"},{default:t(()=>[e(U,null,{default:t(()=>[e(h,{class:"flex-nowrap"},{default:t(()=>[e(Q,{name:"sym_r_delete",size:"xs",class:"me-1"}),_(" "+i(b.$t("delete")),1)]),_:1})]),_:1})]),_:1})),[[R]])]),_:1})]),_:1})]),_:1}))}},Re={class:"q-mb-md"},Te={class:"text-subtitle1 q-mb-sm"},je={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 q-col-gutter-md q-pa-md"},Be=["onClick"],Fe={class:"text-xs sm:mt-2"},Oe={key:0,class:"text-negative text-caption q-mt-sm ms-4"},Ee={__name:"CreateForm",props:{open:{},openModifiers:{}},emits:ye(["created"],["update:open"]),setup(r,{emit:s}){const y=be(r,"open"),p=s,o=x({}),{create:b,creating:v,validation:d}=Ne("servers"),C=[{label:"Linux",value:"amazon-linux",icon:"fab fa-amazon"},{label:"Ubuntu",value:"ubuntu",icon:"fab fa-ubuntu"},{label:"Debian",value:"debian",icon:"fab fa-debian"},{label:"Windows",value:"windows",icon:"fab fa-windows"},{label:"Red Hat",value:"redhat",icon:"fab fa-redhat"}],D=w=>{o.value.os_family=w},T=async()=>{await b(o.value),N(),p("created")},N=()=>{o.value={},d.value={},y.value=!1};return(w,g)=>(u(),$(Me,{open:y.value,"onUpdate:open":g[5]||(g[5]=l=>y.value=l),title:"servers.create",form:"servers-form",onClose:N,loading:n(v)},{form:t(()=>[e(De,{id:"servers-form",onSubmit:we(T,["prevent","self"]),class:"q-gutter-md"},{default:t(()=>[e(Ce,{dense:"",modelValue:o.value.name,"onUpdate:modelValue":g[0]||(g[0]=l=>o.value.name=l),label:w.$t("name")+"*","error-message":n(d).name?.[0],error:"name"in n(d),outlined:"","hide-bottom-space":""},null,8,["modelValue","label","error-message","error"]),e(P,{modelValue:o.value.instance_type,"onUpdate:modelValue":g[1]||(g[1]=l=>o.value.instance_type=l),label:w.$t("servers.instance_type")+"*",resource:"servers/instance-types","option-label":"value","option-value":"value","error-message":n(d).instance_type?.[0],error:"instance_type"in n(d),outlined:"","hide-bottom-space":""},{option:t(l=>[e(S,G(H(l.itemProps)),{default:t(()=>[e(U,null,{default:t(()=>[e(h,null,{default:t(()=>[_(i(l.opt.value),1)]),_:2},1024),e(h,{caption:""},{default:t(()=>[_(i(l.opt.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label","error-message","error"]),m("div",Re,[m("div",Te,i(w.$t("servers.operating_system"))+"*",1),m("div",{class:W(["os-family-grid q-field--outlined",{"q-field--error":"os_family"in n(d)}])},[m("div",je,[(u(),f(he,null,ke(C,l=>m("div",{key:l.label,class:""},[m("div",{class:W(["cursor-pointer text-center q-pa-sm sm:q-pa-md border border-[#ddd] transition-all ease-in-out hover:border-primary-300 rounded-md",{"border-primary-700  text-primary":o.value.os_family?.label===l.label}]),onClick:F=>D(l)},[e(Q,{name:l.icon,size:w.$q.screen.lt.md?"20px":"45px"},null,8,["name","size"]),m("div",Fe,i(l.label),1)],10,Be)])),64))])],2),"os_family"in n(d)?(u(),f("div",Oe,i(n(d).os_family?.[0]),1)):xe("",!0)]),e(P,{modelValue:o.value.security_group_id,"onUpdate:modelValue":g[2]||(g[2]=l=>o.value.security_group_id=l),label:w.$t("security_groups.title")+"*",resource:"security-groups","option-label":"name","error-message":n(d).security_group_id?.[0],error:"security_group_id"in n(d),outlined:"","hide-bottom-space":""},{option:t(l=>[e(S,G(H(l.itemProps)),{default:t(()=>[e(U,null,{default:t(()=>[e(h,null,{default:t(()=>[_(i(l.opt.name),1)]),_:2},1024),e(h,{caption:""},{default:t(()=>[_(i(l.opt.group_id),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","label","error-message","error"]),e(P,{modelValue:o.value.vpc_id,"onUpdate:modelValue":g[3]||(g[3]=l=>o.value.vpc_id=l),label:"VPC*",resource:"vpcs","option-label":"vpc_id","option-value":"vpc_id","error-message":n(d).vpc_id?.[0],error:"vpc_id"in n(d),outlined:"","hide-bottom-space":""},null,8,["modelValue","error-message","error"]),e(P,{modelValue:o.value.ssh_key_id,"onUpdate:modelValue":g[4]||(g[4]=l=>o.value.ssh_key_id=l),resource:"ssh-keys",label:w.$t("ssh_keys.title"),"error-message":n(d).ssh_key_id?.[0],error:"ssh_key_id"in n(d),outlined:"","hide-bottom-space":""},null,8,["modelValue","label","error-message","error"])]),_:1})]),_:1},8,["open","loading"]))}},Ge={key:0},He={class:"font-medium me-2 text-gray-600 dark:text-gray-400"},We={key:0},Je={key:1},Ke={key:0},Xe={key:1},Ye={key:1},Ze={__name:"InstanceTypeColumn",props:{row:{type:Object,required:!0}},setup(r){const{truncate:s}=B();return(y,p)=>r.row.instance_type?(u(),f("div",Ge,[_(i(r.row.instance_type.value)+" ",1),m("div",null,[m("span",He,i(y.$t("servers.image"))+":",1),r.row.image_id?(u(),f("span",We,i(n(s)(r.row.image_id,15)),1)):(u(),f("span",Je,"N/A"))]),m("div",null,[p[0]||(p[0]=m("span",{class:"font-medium me-2 text-gray-600 dark:text-gray-400"},"OS:",-1)),r.row.os_family?(u(),f("span",Ke,[e(Q,{name:r.row.os_family?.icon},null,8,["name"]),_(" "+i(r.row.os_family?.label),1)])):(u(),f("span",Xe,"N/A"))])])):(u(),f("div",Ye,[...p[1]||(p[1]=[m("div",null,"N/A",-1)])]))}},et={key:0},tt={key:0},at={key:1},st={key:1},lt={__name:"SecurityGroupColumn",props:{row:{type:Object,required:!0}},setup(r){const{truncate:s}=B();return(y,p)=>r.row.security_group?(u(),f("div",et,[_(i(n(s)(r.row.security_group.group_id,15))+" ",1),m("div",null,[p[0]||(p[0]=m("span",{class:"font-medium me-2 text-gray-600 dark:text-gray-400"},"VPC:",-1)),r.row.vpc_id?(u(),f("span",tt,i(n(s)(r.row.vpc_id,10)),1)):(u(),f("span",at,"N/A"))])])):(u(),f("div",st,[...p[1]||(p[1]=[m("div",null,"N/A",-1)])]))}},rt={class:"font-medium me-2 text-gray-600 dark:text-gray-400"},ot={key:0},nt={key:1},it={__name:"InstanceNameColumn",props:{row:{type:Object,required:!0}},setup(r){const{truncate:s}=B();return(y,p)=>(u(),f("div",null,[_(i(n(s)(r.row.name,30))+" ",1),m("div",null,[m("span",rt,i(y.$t("servers.instance_id"))+":",1),r.row.instance_id?(u(),f("span",ot,i(n(s)(r.row.instance_id,10)),1)):(u(),f("span",nt,"N/A"))])]))}},ut={class:"mt-4 bg-white dark:bg-slate-800 p-3 rounded-md"},dt={class:"flex items-center justify-between gap-3 mb-3"},It={__name:"IndexView",setup(r){const{t:s}=$e(),y=I(()=>[{name:"id",label:s("id"),field:"id",align:"left",sortable:!0},{name:"name",label:s("name"),field:"name",align:"left",sortable:!0},{name:"security_group",label:s("security_groups.title"),field:"security_group",align:"left",sortable:!1},{name:"instance_type",label:s("servers.instance_type"),field:"instance_type",align:"left",sortable:!1},{name:"public_ip_address",label:s("servers.public_ip_address"),field:"public_ip_address",align:"left",sortable:!0},{name:"status",label:s("status"),field:"status",align:"left",sortable:!1},{name:"created_at",label:s("creation_date"),field:"created_at",align:"left",sortable:!0},{label:s("actions"),name:"actions",field:"actions",align:"center"}]),p=I(()=>[{name:"vpc_id",label:"VPC ID",type:"relation",resource:"vpcs",optionLabel:"vpc_id",optionValue:"vpc_id"},{name:"security_group_id",label:s("security_groups.group_id"),type:"relation",resource:"security-groups",optionLabel:"group_id",optionValue:"group_id"},{name:"instance_type",label:s("servers.instance_type"),type:"enum",resource:"servers/instance-types",optionLabel:"value",optionValue:"value"},{name:"os_family",label:s("servers.operating_system"),type:"enum",resource:"servers/os-families",optionLabel:"value",optionValue:"value"},{name:"status",label:s("status"),type:"enum",resource:"servers/statuses",optionLabel:"label",optionValue:"value"},{name:"created_at",label:s("creation_date"),type:"date"}]),o=x(""),{data:b,fetch:v,loading:d,options:C,onRequest:D}=Se("servers"),{destroy:T,destroying:N,destroyed:w}=Ue("servers"),{update:g,updating:l}=K(()=>`servers/${j.value.id}/start`),{update:F,updating:X}=K(()=>`servers/${j.value.id}/stop`),{start:Y,stop:Z}=Le(()=>{v({filter:o.value,filters:C.filters})},2e4),M=x(!1),L=x(!1),z=x(!1),O=x(null),j=x(null),V=x(!1),ee=I(()=>V.value==="start"?s("servers.start_server"):s("servers.stop_server")),te=I(()=>V.value==="start"?s("servers.start"):s("servers.stop")),ae=I(()=>V.value==="start"?l.value:X.value),se=()=>{D({filter:o.value})};function le({search:q,filters:c}){v({filter:q,filters:c})}const re=()=>{M.value=!0},oe=q=>{O.value=q,L.value=!0},ne=(q,c)=>{j.value=q,V.value=c,z.value=!0},E=()=>{z.value=!1,V.value=null,v({filter:o.value,filters:C.filters})},ie=async()=>{if(V.value==="start"){await g(),E();return}await F(),E()},ue=async()=>{await T(O.value.id),w.value&&(L.value=!1,v({filter:o.value,filters:C.filters}))},de=()=>{M.value=!1,v({filter:o.value,filters:C.filters})};return Ve(()=>{Pe(Y,3e3)()}),qe(()=>{Z()}),(q,c)=>(u(),$(fe,{class:"q-pa-md"},{default:t(()=>[e(Ee,{open:M.value,"onUpdate:open":c[0]||(c[0]=a=>M.value=a),onCreated:de},null,8,["open"]),e(J,{open:L.value,"onUpdate:open":c[1]||(c[1]=a=>L.value=a),title:"servers.delete",icon:"warning",color:"negative",loading:n(N),onConfirm:ue,onCancel:c[2]||(c[2]=a=>L.value=!1)},null,8,["open","loading"]),e(J,{open:z.value,"onUpdate:open":c[3]||(c[3]=a=>z.value=a),title:ee.value,icon:"info",color:"warning",actionLabel:te.value,loading:ae.value,onConfirm:ie,onCancel:c[4]||(c[4]=a=>z.value=!1)},null,8,["open","title","actionLabel","loading"]),e(Qe,{title:"servers.title",subtitle:"servers.subtitle",icon:"sym_r_host",actionLabel:"servers.create",actionIcon:"add",action:re}),m("div",ut,[m("div",dt,[e(me,{onSearch:se,searchValue:o.value,"onUpdate:searchValue":c[5]||(c[5]=a=>o.value=a),class:"md:max-w-sm max-w-full"},null,8,["searchValue"]),e(ce,{filters:p.value,onUpdate:le},null,8,["filters"])]),e(pe,{columns:y.value,rows:n(b)??[],loading:n(d),pagination:n(C).pagination,"onUpdate:pagination":c[6]||(c[6]=a=>n(C).pagination=a),onRequest:n(D),flat:"","rows-per-page-options":[5,10,20,30,40,50,100]},{"body-cell-name":t(a=>[e(k,{props:a,title:a.row.instance_id},{default:t(()=>[e(it,{row:a.row},null,8,["row"])]),_:2},1032,["props","title"])]),"body-cell-security_group":t(a=>[e(k,{props:a,title:a.row.security_group.group_id},{default:t(()=>[e(lt,{row:a.row},null,8,["row"])]),_:2},1032,["props","title"])]),"body-cell-instance_type":t(a=>[e(k,{props:a,title:a.row.image_id},{default:t(()=>[e(Ze,{row:a.row},null,8,["row"])]),_:2},1032,["props","title"])]),"body-cell-public_ip_address":t(a=>[e(k,{props:a,title:a.row.public_ip_address},{default:t(()=>[_(i(a.row.public_ip_address??"N/A"),1)]),_:2},1032,["props","title"])]),"body-cell-status":t(a=>[e(k,{props:a,title:a.row.status.label},{default:t(()=>[e(ve,{"text-color":a.row.status.color,size:"xs",class:"w-fit"},{default:t(()=>[_(i(a.row.status.label),1)]),_:2},1032,["text-color"])]),_:2},1032,["props","title"])]),"body-cell-created_at":t(a=>[e(k,{props:a,title:a.row.created_by?.name??a.row.create_at},{default:t(()=>[_(i(a.row.created_at),1)]),_:2},1032,["props","title"])]),"body-cell-actions":t(a=>[e(k,{props:a},{default:t(()=>[e(Ae,{row:a.row,onStatusChange:ne,onDelete:oe},null,8,["row"])]),_:2},1032,["props"])]),_:1},8,["columns","rows","loading","pagination","onRequest"])])]),_:1}))}};export{It as default};
